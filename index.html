<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Gen Pro - Suite Completa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <style>
        .tab-btn.active {
            background-color: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }
        /* Centratura Canvas QR */
        #qrcode canvas, #qrcode img {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans min-h-screen flex flex-col">

    <nav class="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-qrcode text-indigo-600 text-2xl"></i>
                    <span class="font-bold text-xl tracking-tight text-slate-900">QR Gen <span class="text-indigo-600">Pro</span></span>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-4 py-8 max-w-5xl">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-2 space-y-6">
                <div class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden">
                    <div class="flex border-b border-slate-200 overflow-x-auto">
                        <button onclick="switchTab('url')" id="tab-url" class="tab-btn active flex-1 py-4 px-6 text-sm font-medium text-slate-500 hover:text-indigo-600 transition-colors whitespace-nowrap">URL</button>
                        <button onclick="switchTab('wifi')" id="tab-wifi" class="tab-btn flex-1 py-4 px-6 text-sm font-medium text-slate-500 hover:text-indigo-600 transition-colors whitespace-nowrap">Wi-Fi</button>
                        <button onclick="switchTab('vcard')" id="tab-vcard" class="tab-btn flex-1 py-4 px-6 text-sm font-medium text-slate-500 hover:text-indigo-600 transition-colors whitespace-nowrap">Contatti</button>
                        <button onclick="switchTab('text')" id="tab-text" class="tab-btn flex-1 py-4 px-6 text-sm font-medium text-slate-500 hover:text-indigo-600 transition-colors whitespace-nowrap">Testo</button>
                    </div>

                    <div class="p-6">
                        <div id="form-url" class="input-group">
                            <label class="block text-sm font-medium text-slate-700 mb-2">Inserisci URL</label>
                            <input type="url" id="url-input" placeholder="https://www.google.it" class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-indigo-500 outline-none" oninput="generateQR()">
                        </div>

                        <div id="form-wifi" class="input-group hidden space-y-4">
                            <div class="bg-blue-50 border border-blue-100 rounded-lg p-4 mb-4 flex items-start gap-3">
                                <i class="fa-solid fa-print text-blue-600 mt-1"></i>
                                <div>
                                    <h4 class="font-bold text-blue-900 text-sm">Crea Cartello Wi-Fi</h4>
                                    <p class="text-xs text-blue-700">Compila i dati e clicca il pulsante nero qui sotto. Si aprirà una pagina di stampa perfetta.</p>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Nome Rete (SSID)</label>
                                <input type="text" id="wifi-ssid" placeholder="IlTuoWiFi" class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-indigo-500 outline-none" oninput="generateQR()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Password</label>
                                <input type="text" id="wifi-pass" placeholder="Password123" class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-indigo-500 outline-none" oninput="generateQR()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Crittografia</label>
                                <select id="wifi-type" class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-indigo-500 outline-none" onchange="generateQR()">
                                    <option value="WPA">WPA/WPA2</option>
                                    <option value="WEP">WEP</option>
                                    <option value="nopass">Nessuna Password</option>
                                </select>
                            </div>
                            
                            <button onclick="printWifiCard()" class="w-full mt-6 bg-slate-900 text-white font-bold py-4 px-6 rounded-xl hover:bg-black transition-colors flex items-center justify-center gap-3 shadow-xl transform active:scale-95 duration-200">
                                <i class="fa-solid fa-print text-xl"></i>
                                <span class="text-lg">Stampa / Salva PDF Card</span>
                            </button>
                        </div>

                        <div id="form-vcard" class="input-group hidden space-y-4">
                            <div class="bg-blue-50 border border-blue-100 rounded-lg p-4 mb-4 flex items-start gap-3">
                                <i class="fa-solid fa-print text-blue-600 mt-1"></i>
                                <div>
                                    <h4 class="font-bold text-blue-900 text-sm">Crea Card di Contatto</h4>
                                    <p class="text-xs text-blue-700">Compila i dati e clicca il pulsante nero qui sotto. Si aprirà una pagina di stampa perfetta.</p>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <input type="text" id="vcard-name" placeholder="Nome" class="w-full px-4 py-3 rounded-lg border border-slate-300" oninput="generateQR()">
                                <input type="text" id="vcard-surname" placeholder="Cognome" class="w-full px-4 py-3 rounded-lg border border-slate-300" oninput="generateQR()">
                            </div>
                            <input type="tel" id="vcard-phone" placeholder="Telefono" class="w-full px-4 py-3 rounded-lg border border-slate-300" oninput="generateQR()">
                            <input type="email" id="vcard-email" placeholder="Email" class="w-full px-4 py-3 rounded-lg border border-slate-300" oninput="generateQR()">

                            <button onclick="printVCard()" class="w-full mt-6 bg-slate-900 text-white font-bold py-4 px-6 rounded-xl hover:bg-black transition-colors flex items-center justify-center gap-3 shadow-xl transform active:scale-95 duration-200">
                                <i class="fa-solid fa-print text-xl"></i>
                                <span class="text-lg">Stampa / Salva PDF Card</span>
                            </button>
                        </div>

                        <div id="form-text" class="input-group hidden">
                            <textarea id="text-input" rows="4" placeholder="Messaggio..." class="w-full px-4 py-3 rounded-lg border border-slate-300" oninput="generateQR()"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-1">
                <div class="bg-indigo-600 rounded-2xl shadow-xl p-8 text-center text-white sticky top-24">
                    <h2 class="text-xl font-bold mb-6">Anteprima</h2>
                    <div class="bg-white p-4 rounded-xl shadow-inner mx-auto max-w-[250px] aspect-square flex items-center justify-center mb-6 overflow-hidden">
                        <div id="qrcode"></div>
                    </div>
                    <button onclick="downloadQRImage()" class="w-full bg-white text-indigo-600 font-bold py-3 px-6 rounded-lg shadow hover:bg-indigo-50 transition-colors flex items-center justify-center gap-2">
                        <i class="fa-solid fa-image"></i> Scarica PNG
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-white border-t border-slate-200 text-center py-6 mt-12">
        <p class="mb-2 text-sm text-slate-600">All data inserted is used solely for generating QR codes and is not stored or shared. The QR codes generated are local and processed entirely within your browser. The privacy of your information is our priority.</p>
        <p class="text-sm text-slate-500">&copy; 2024 <a href="https://federico-mattucci.vercel.app/">Federico Mattucci</a>. All rights reserved.</p>
    </footer>

    <script>
        let currentMode = 'url';
        let qrContainer = document.getElementById("qrcode");
        let qrCodeObj = null;

        window.onload = function() { generateQR(); };

        function switchTab(mode) {
            currentMode = mode;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active') && btn.classList.add('hover:text-indigo-600'));
            const tab = document.getElementById('tab-' + mode)
            tab.classList.add('active');
            tab.classList.remove('hover:text-indigo-600');
            document.querySelectorAll('.input-group').forEach(group => group.classList.add('hidden'));
            document.getElementById('form-' + mode).classList.remove('hidden');
            generateQR();
        }

        function generateQR() {
            let textToEncode = "";
            let wifiSSID = "";
            let wifiPass = "";
            const wifiType = document.getElementById('wifi-type') ? document.getElementById('wifi-type').value : 'WPA';

            switch (currentMode) {
                case 'url':
                    textToEncode = document.getElementById('url-input').value || "https://example.com";
                    break;
                case 'wifi':
                    wifiSSID = document.getElementById('wifi-ssid').value;
                    wifiPass = document.getElementById('wifi-pass').value;
                    if(wifiSSID) {
                        textToEncode = `WIFI:S:${wifiSSID};T:${wifiType};P:${wifiPass};;`;
                    } else {
                        textToEncode = "Inserisci Nome Rete";
                    }
                    break;
                case 'vcard':
                    const n = document.getElementById('vcard-name').value;
                    const s = document.getElementById('vcard-surname').value;
                    const p = document.getElementById('vcard-phone').value;
                    const e = document.getElementById('vcard-email').value;
                    textToEncode = `BEGIN:VCARD\nVERSION:3.0\nN:${s};${n}\nFN:${n} ${s}\nTEL;TYPE=CELL:${p}\nEMAIL:${e}\nEND:VCARD`;
                    break;
                case 'text':
                    textToEncode = document.getElementById('text-input').value || "Testo...";
                    break;
            }

            qrContainer.innerHTML = "";
            qrCodeObj = new QRCode(qrContainer, {
                text: textToEncode,
                width: 256,
                height: 256,
                colorDark : "#000000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
        }

        function getQRDataUrl() {
            // Estrazione sicura dell'immagine dal Canvas
            const canvas = qrContainer.querySelector("canvas");
            if (canvas) return canvas.toDataURL("image/png");
            
            const img = qrContainer.querySelector("img");
            if (img) return img.src;
            
            return null;
        }

        function downloadQRImage() {
            const dataUrl = getQRDataUrl();
            if (dataUrl) {
                const link = document.createElement("a");
                link.href = dataUrl;
                link.download = "qr-code.png";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function printWifiCard() {
            if (currentMode !== 'wifi') return;
            
            const ssid = document.getElementById('wifi-ssid').value || "Nome Rete";
            const pass = document.getElementById('wifi-pass').value || "Nessuna Password";
            const qrData = getQRDataUrl();

            if(!qrData) { alert("Attendi caricamento QR..."); return; }

            // Creiamo un documento HTML al volo per la stampa
            // Questo assicura che il QR Code (passato come base64) sia SEMPRE visibile
            const win = window.open('', '', 'height=700,width=900');
            
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>WiFi Card - ${ssid}</title>
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
                        
                        body {
                            font-family: 'Inter', sans-serif;
                            background-color: #f3f4f6;
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            min-height: 100vh;
                            margin: 0;
                            -webkit-print-color-adjust: exact !important;
                            print-color-adjust: exact !important;
                        }

                        .card {
                            background: white;
                            width: 100%;
                            max-width: 600px;
                            border: 8px solid #111827; /* Nero quasi */
                            padding: 60px 40px;
                            text-align: center;
                            border-radius: 40px;
                            position: relative;
                            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
                        }

                        .icon { font-size: 60px; color: #4f46e5; margin-bottom: 20px; }
                        h1 { font-size: 48px; font-weight: 900; color: #111827; margin: 0; text-transform: uppercase; letter-spacing: -1px; }
                        p.subtitle { color: #6b7280; font-size: 18px; margin-top: 10px; margin-bottom: 40px; }

                        .qr-box {
                            background: white; /* Per contrasto */
                            padding: 20px;
                            border: 2px solid #e5e7eb;
                            border-radius: 20px;
                            display: inline-block;
                            margin-bottom: 40px;
                        }
                        
                        .qr-box img {
                            width: 250px;
                            height: 250px;
                            display: block;
                        }

                        .info-box {
                            text-align: left;
                            background: #f9fafb;
                            padding: 30px;
                            border-radius: 16px;
                            border: 1px solid #e5e7eb;
                        }

                        .label { display: block; font-size: 12px; font-weight: 700; text-transform: uppercase; color: #9ca3af; letter-spacing: 1px; margin-bottom: 4px; }
                        .value { display: block; font-size: 28px; font-weight: 700; color: #111827; font-family: monospace; word-break: break-all; margin-bottom: 20px; }
                        .value:last-child { margin-bottom: 0; }

                        /* Nasconde elementi durante la stampa se necessario */
                        @media print {
                            body { background: white; }
                            .card { box-shadow: none; border-width: 6px; }
                        }
                    </style>
                </head>
                <body>
                    <div class="card">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12.55a11 11 0 0 1 14.08 0"></path><path d="M1.42 9a16 16 0 0 1 21.16 0"></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path><line x1="12" y1="20" x2="12.01" y2="20"></line></svg>
                        </div>
                        
                        <h1>Wi-Fi</h1>
                        <p class="subtitle">Scan to connect automatically</p>
                        
                        <div class="qr-box">
                            <img src="${qrData}" alt="QR Code WiFi" />
                        </div>

                        <div class="info-box">
                            <span class="label">Network (SSID)</span>
                            <span class="value">${ssid}</span>
                            
                            <span class="label">Password</span>
                            <span class="value">${pass}</span>
                        </div>
                    </div>
                    <script>
                        // Avvia la stampa automaticamente
                        window.onload = function() { window.print(); }
                    <\/script>
                </body>
                </html>
            `;

            win.document.write(htmlContent);
            win.document.close(); // Importante per far finire il caricamento
        }


        function printVCard() {
            if (currentMode !== 'vcard') return;
            
            const n = document.getElementById('vcard-name').value;
            const s = document.getElementById('vcard-surname').value;
            const p = document.getElementById('vcard-phone').value;
            const e = document.getElementById('vcard-email').value;
            const qrData = getQRDataUrl();

            if(!qrData) { alert("Attendi caricamento QR..."); return; }

            // Creiamo un documento HTML al volo per la stampa
            // Questo assicura che il QR Code (passato come base64) sia SEMPRE visibile
            const win = window.open('', '', 'height=700,width=900');
            
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Contact Card - ${n} ${s}</title>
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
                        
                        body {
                            font-family: 'Inter', sans-serif;
                            background-color: #f3f4f6;
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            min-height: 100vh;
                            margin: 0;
                            -webkit-print-color-adjust: exact !important;
                            print-color-adjust: exact !important;
                        }

                        .card {
                            background: white;
                            width: 100%;
                            max-width: 900px;
                            border: 6px solid #111827;
                            padding: 40px;
                            display: flex;
                            gap: 40px;
                            align-items: center;
                            border-radius: 24px;
                            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
                        }

                        .left-section {
                            flex: 1;
                            display: flex;
                            flex-direction: column;
                            justify-content: center;
                        }

                        h1 { font-size: 42px; font-weight: 900; color: #111827; margin: 0 0 30px 0; letter-spacing: -0.5px; }
                        
                        .info-box {
                            background: #f9fafb;
                            padding: 24px;
                            border-radius: 16px;
                            border: 1px solid #e5e7eb;
                        }

                        .info-item {
                            margin-bottom: 20px;
                        }

                        .info-item:last-child {
                            margin-bottom: 0;
                        }

                        .label { display: block; font-size: 11px; font-weight: 700; text-transform: uppercase; color: #9ca3af; letter-spacing: 0.5px; margin-bottom: 6px; }
                        .value { display: block; font-size: 18px; font-weight: 600; color: #111827; word-break: break-all; }

                        .right-section {
                            flex: 0 0 auto;
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                        }

                        .qr-box {
                            background: white;
                            padding: 16px;
                            border: 2px solid #e5e7eb;
                            border-radius: 16px;
                        }
                        
                        .qr-box img {
                            width: 220px;
                            height: 220px;
                            display: block;
                        }

                        @media print {
                            body { background: white; }
                            .card { box-shadow: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="card">
                        <div class="left-section">
                            <h1>${n} ${s}</h1>
                            <div class="info-box">
                                <div class="info-item">
                                    <span class="label">Phone</span>
                                    <span class="value">${p || '-'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Email</span>
                                    <span class="value">${e || '-'}</span>
                                </div>
                            </div>
                        </div>
                        <div class="right-section">
                            <div class="qr-box">
                                <img src="${qrData}" alt="QR Code Contact" />
                            </div>
                        </div>
                    </div>
                    <script>
                        window.onload = function() { window.print(); }
                    <\/script>
                </body>
                </html>
            `;

            win.document.write(htmlContent);
            win.document.close(); // Importante per far finire il caricamento
        }
    </script>
</body>
</html>